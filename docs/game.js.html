<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: game.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: game.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>var n_gems = 5;
var board_h = 5;
var board_w = 5;
var board;

/**
 * Prints board to console.
 */
function log_board() {
    for(var i = 0; i &lt; board.length; i++)
        console.log(i.toString() + " - " + board[i].toString());
}

/**
 * Checks gems for sequence of 3+ repeating gems.
 * @param {object} gems array of gems
 * @returns {{idx: number, count: number}|null} start and size of sequence
 */
function check_sequence(gems) {
    var idx = 0;

    while(idx &lt; gems.length) {
        var count = 1;
        while(count &lt; gems.length &amp;&amp; gems[idx] == gems[idx + count]){
            count++;
        }

        if(count > 2)
            return {idx, count};

        idx += count;
    }

    return null;
}

/**
 * Applies check_sequence() for all rows and columns of the board.
 * @returns {{dir: number, idx: number, count: number}|null} direction (0=row | 1=column),
 start and size of sequence
 */
function check() {
    var checked = null;

    // check rows
    for(var row = 0; row &lt; board_h; row++) {
        checked = check_sequence(board[row]);
        if(checked != null) {
            return {dir: 0,
                    ...checked};
        }
    }

    // check cols
    for(var col = 0; col &lt; board_w; col++) {
        var column = [];
        for(var i = 0; i &lt; board_h; i++)
            column.push(board[i][col]);

        checked = check_sequence(column);
        if(checked != null) {
            return {dir: 1,
                    ...checked};
        }
    }

    return null;
}

/**
 * Generates new random gems for a specific column.
 * @param {number} column index of column
 * @param {number} count number of gems to generate
 * @returns {object} array of generated gems
 */
function gen_gems(column, count) {
    var gems = [];
    var possible_gems;

    for(var i = 0; i &lt; count; i++) {
        possible_gems = [0, 1, 1, 1, 1, 1];

        if(column > 0)
            possible_gems[board[i][column - 1]] = 0;

        if(column &lt; board_w - 1){
            possible_gems[board[i][column + 1]] = 0;
        }

        if(gems.length > 0)
            possible_gems[gems[gems.length - 1]] = 0;

        var gem_choices = [];
        for(var j = 1; j &lt;= n_gems; j++)
            if(possible_gems[j]) gem_choices.push(j);

        gems.push(gem_choices[Math.floor(Math.random() * gem_choices.length)]);
    }

    return gems;
}

/**
 * Makes gems fall over empty spaces (deleted gems), pushing new gems to the top
 of the column.
 * @param {number} col index of column
 * @param {number} start start of the deleted sequence
 * @param {number} count size of the deleted sequence
 * @returns {object} array containing column after fall
 */
function fall_column(column, start, count) {
    var old_column = [];
    for(var i = 0; i &lt; board_h; i++)
        old_column.push(board[i][column]);

    return gen_gems(column, count).concat(old_column.slice(0, start),
                                          old_column.slice(start+count, board_h));
}

function init() {
    board = [[0, 1, 0, 0, 0],
             [0, 2, 0, 0, 0],
             [0, 3, 0, 0, 0],
             [0, 4, 0, 0, 0],
             [0, 5, 0, 0, 0]];
    // board = [[1, 2, 2, 0, 2],
    //          [1, 2, 3, 4, 5],
    //          [1, 2, 3, 4, 5],
    //          [1, 2, 3, 4, 5],
    //          [1, 2, 3, 4, 5]];

}

function main() {
    init();

    console.log(fall_column(1, 2, 1));
}

main();</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-board.html">board</a></li><li><a href="module-utils.html">utils</a></li></ul><h3>Global</h3><ul><li><a href="global.html#check">check</a></li><li><a href="global.html#check_sequence">check_sequence</a></li><li><a href="global.html#fall_column">fall_column</a></li><li><a href="global.html#gen_gems">gen_gems</a></li><li><a href="global.html#log_board">log_board</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.6</a> on Mon Jan 11 2021 23:55:31 GMT-0300 (Brasilia Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
